$(document).on("ready",function(){function s(){n=$(".game");r=$("<span class='game-button'>NEW GAME<\/span>");r.on("click",h);n.append(r);$(document).on("keydown",function(n){console.log(n);switch(n.which){case 32:o();break;case 37:t("W");break;case 38:t("N");break;case 39:t("E");break;case 40:t("S");break;default:return}n.preventDefault()})}function h(){r.remove();var t=$("<input type='text' id='txtUsername' name='txtUsername' class='game-input' placeholder='Username' />"),u=$("<select id='cboDifficulty' name='cboDifficulty' class='game-input' />").append($("<option value=1>Easy<\/option>"),$("<option value=2>Normal<\/option>"),$("<option value=3>Hard<\/option>")),i=$("<span class='game-button'>START GAME<\/span>"),f=$("<div class='message'> <\/div>");i.on("click",e);t.on("keydown",function(n){console.log(n);13===n.keyCode&&e(n)});n.append(t);n.append(u);n.append(i);n.append(f)}function e(){var t=$("#txtUsername").val(),r=$("#cboDifficulty").val();if(f=$("#cboDifficulty option:selected").text(),$(".message").empty(),!t){$(".message").html($("<span>Username required<\/span>"));return}n.empty();$.ajax({url:"/api/NewGame",data:{username:t,difficulty:r},success:function(n){i=n.user;u(n)}})}function c(n){var i=$("<div class='controls' />"),r;switch(n.fullMap.currentAction){case 1:case 2:r=$("<span class='game-button'>ATTACK<\/span>");r.on("click",o);break;case 3:return i;case 4:return i}var u=$("<span class='game-button'>NORTH<\/span>"),f=$("<span class='game-button'>WEST<\/span>"),e=$("<span class='game-button'>EAST<\/span>"),s=$("<span class='game-button'>SOUTH<\/span>");u.on("click",function(){t("N")});f.on("click",function(){t("W")});e.on("click",function(){t("E")});s.on("click",function(){t("S")});return r?i.append($("<div />").append(r)):(i.append(u),i.append(f),i.append(e),i.append(s)),i}function o(){$.ajax({url:"/api/Attack",method:"POST",data:{user:i},success:function(t){n.empty();i=t.user;u(t)}})}function l(n){var t=$("<div class='info' />"),i;t.append($("<span>Username: "+n.fullMap.currentPlayer.username+"<\/span>"));t.append($("<span>Lives: "+n.fullMap.currentPlayer.lives+"<\/span>"));t.append($("<span>Score: "+n.fullMap.currentPlayer.score+"<\/span>"));i="Walk";switch(n.fullMap.currentAction){case 1:i="Attack monster";break;case 2:i="Attack The boss";break;case 3:return t.append($("<span>GAME OVER<\/span>")),t;case 4:return t.append($("<span>YOU WON<\/span>")),t}return t.append($("<span>Action: "+i+"<\/span>")),n.fullMap.currentMonster&&t.append($("<span>Monster lives: "+n.fullMap.currentMonster.lives+"<\/span>")),t}function t(t){$.ajax({url:"/api/Move",method:"POST",data:{user:i,direction:t},success:function(t){n.empty();i=t.user;u(t)}})}function u(t){var u=t.map,i=$("<div class='map "+f.toLowerCase()+"' />"),e=u.split("\r\n"),r="";switch(t.fullMap.currentAction){case 1:r="monster";break;case 2:r="boss";break;case 3:r="gameover";break;case 4:r="win";break;case 5:r="visited";break;case 6:r="healing";break;case 7:r="toxic"}e.forEach(function(n){n.split("").forEach(function(n){switch(n){case"P":i.append($("<div class='player "+r+"' />"));break;case"B":i.append($("<div class='boss' />"));break;case"M":i.append($("<div class='monster' />"));break;case"H":i.append($("<div class='healing' />"));break;case"T":i.append($("<div class='toxic' />"));break;case"V":i.append($("<div class='visited' />"));break;case" ":i.append($("<div class='empty' />"))}})});n.append(l(t));n.append(i);n.append(c(t))}var n,r,f,i;s()});